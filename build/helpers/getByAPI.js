var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.getByAPI=exports.getAllByTestId=exports.getAllByProps=exports.getAllByPlaceholder=exports.getAllByText=exports.getAllByType=exports.getAllByName=exports.getAllBy=exports.getByTestId=exports.getByProps=exports.getByPlaceholder=exports.getByText=exports.getByType=exports.getByName=exports.getBy=void 0;var _toArray2=_interopRequireDefault(require("@babel/runtime/helpers/toArray"));var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var React=_interopRequireWildcard(require("react"));var _prettyFormat=_interopRequireDefault(require("pretty-format"));var _isPlainObject=_interopRequireDefault(require("is-plain-object"));var _errors=require("./errors");var filterNodeByType=function filterNodeByType(node,type){return node.type===type;};var filterNodeByName=function filterNodeByName(node,name){return typeof node.type!=='string'&&(node.type.displayName===name||node.type.name===name);};var getNodeByText=function getNodeByText(node,text){try{var _require=require('react-native'),Text=_require.Text,TextInput=_require.TextInput;var isTextComponent=filterNodeByType(node,Text)||filterNodeByType(node,TextInput);if(isTextComponent){var textChildren=React.Children.map(node.props.children,function(child){return child?child.toString():'';});if(textChildren){var textToTest=textChildren.join('');return typeof text==='string'?text===textToTest:text.test(textToTest);}}return false;}catch(error){throw(0,_errors.createLibraryNotSupportedError)(error);}};var getTextInputNodeByPlaceholder=function getTextInputNodeByPlaceholder(node,placeholder){try{var _require2=require('react-native'),TextInput=_require2.TextInput;return filterNodeByType(node,TextInput)&&(typeof placeholder==='string'?placeholder===node.props.placeholder:placeholder.test(node.props.placeholder));}catch(error){throw(0,_errors.createLibraryNotSupportedError)(error);}};var makePaths=function makePaths(criteria){var _ref;return(_ref=[]).concat.apply(_ref,(0,_toConsumableArray2.default)(Object.keys(criteria).map(function(key){return(0,_isPlainObject.default)(criteria[key])?makePaths(criteria[key]).map(function(_ref2){var path=_ref2.path,value=_ref2.value;return{path:[key].concat((0,_toConsumableArray2.default)(path)),value:value};}):[{path:[key],value:criteria[key]}];})));};var makeTest=function makeTest(criteria){if(criteria.testID){criteria.props=(0,_objectSpread2.default)({testID:criteria.testID},criteria.props);delete criteria.testID;}var paths=makePaths(criteria);return function(node){return paths.every(function(_ref3){var _ref3$path=(0,_toArray2.default)(_ref3.path),path=_ref3$path.slice(0),value=_ref3.value;var curr=node;while(path.length){curr=curr[path.shift()];if(!curr)return false;}return value instanceof RegExp&&typeof curr==='string'?new RegExp(value).test(curr):curr===value;});};};var getBy=function getBy(instance){return function getByFn(criteria){try{var test=typeof criteria==='object'?makeTest(criteria):criteria;return instance.find(test);}catch(error){throw new _errors.ErrorWithStack((0,_errors.prepareErrorMessage)(error),getByFn);}};};exports.getBy=getBy;var getByName=function getByName(instance){return function getByNameFn(name){(0,_errors.logDeprecationWarning)('getByName','getByType');try{return typeof name==='string'?instance.find(function(node){return filterNodeByName(node,name);}):instance.findByType(name);}catch(error){throw new _errors.ErrorWithStack((0,_errors.prepareErrorMessage)(error),getByNameFn);}};};exports.getByName=getByName;var getByType=function getByType(instance){return function getByTypeFn(type){try{return instance.findByType(type);}catch(error){throw new _errors.ErrorWithStack((0,_errors.prepareErrorMessage)(error),getByTypeFn);}};};exports.getByType=getByType;var getByText=function getByText(instance){return function getByTextFn(text){try{return instance.find(function(node){return getNodeByText(node,text);});}catch(error){throw new _errors.ErrorWithStack((0,_errors.prepareErrorMessage)(error),getByTextFn);}};};exports.getByText=getByText;var getByPlaceholder=function getByPlaceholder(instance){return function getByPlaceholderFn(placeholder){try{return instance.find(function(node){return getTextInputNodeByPlaceholder(node,placeholder);});}catch(error){throw new _errors.ErrorWithStack((0,_errors.prepareErrorMessage)(error),getByPlaceholderFn);}};};exports.getByPlaceholder=getByPlaceholder;var getByProps=function getByProps(instance){return function getByPropsFn(props){try{return instance.findByProps(props);}catch(error){throw new _errors.ErrorWithStack((0,_errors.prepareErrorMessage)(error),getByPropsFn);}};};exports.getByProps=getByProps;var getByTestId=function getByTestId(instance){return function getByTestIdFn(testID){try{return instance.findByProps({testID:testID});}catch(error){throw new _errors.ErrorWithStack((0,_errors.prepareErrorMessage)(error),getByTestIdFn);}};};exports.getByTestId=getByTestId;var getAllBy=function getAllBy(instance){return function getAllByFn(criteria){var test=typeof criteria==='object'?makeTest(criteria):criteria;var results=instance.findAll(test);if(results.length===0){throw new _errors.ErrorWithStack("No instances found with for criteria:\n"+(0,_prettyFormat.default)(criteria),getAllByFn);}return results;};};exports.getAllBy=getAllBy;var getAllByName=function getAllByName(instance){return function getAllByNameFn(name){(0,_errors.logDeprecationWarning)('getAllByName','getAllByType');var results=typeof name==='string'?instance.findAll(function(node){return filterNodeByName(node,name);}):instance.findAllByType(name);if(results.length===0){throw new _errors.ErrorWithStack('No instances found',getAllByNameFn);}return results;};};exports.getAllByName=getAllByName;var getAllByType=function getAllByType(instance){return function getAllByTypeFn(type){var results=instance.findAllByType(type);if(results.length===0){throw new _errors.ErrorWithStack('No instances found',getAllByTypeFn);}return results;};};exports.getAllByType=getAllByType;var getAllByText=function getAllByText(instance){return function getAllByTextFn(text){var results=instance.findAll(function(node){return getNodeByText(node,text);});if(results.length===0){throw new _errors.ErrorWithStack("No instances found with text: "+String(text),getAllByTextFn);}return results;};};exports.getAllByText=getAllByText;var getAllByPlaceholder=function getAllByPlaceholder(instance){return function getAllByPlaceholderFn(placeholder){var results=instance.findAll(function(node){return getTextInputNodeByPlaceholder(node,placeholder);});if(results.length===0){throw new _errors.ErrorWithStack("No instances found with placeholder: "+String(placeholder),getAllByPlaceholderFn);}return results;};};exports.getAllByPlaceholder=getAllByPlaceholder;var getAllByProps=function getAllByProps(instance){return function getAllByPropsFn(props){var results=instance.findAllByProps(props);if(results.length===0){throw new _errors.ErrorWithStack("No instances found with props:\n"+(0,_prettyFormat.default)(props),getAllByPropsFn);}return results;};};exports.getAllByProps=getAllByProps;var getAllByTestId=function getAllByTestId(instance){return function getAllByTestIdFn(testID){var results=instance.findAllByProps({testID:testID});if(results.length===0){throw new _errors.ErrorWithStack("No instances found with testID: "+String(testID),getAllByTestIdFn);}return results;};};exports.getAllByTestId=getAllByTestId;var getByAPI=function getByAPI(instance){return{getBy:getBy(instance),getByTestId:getByTestId(instance),getByName:getByName(instance),getByType:getByType(instance),getByText:getByText(instance),getByPlaceholder:getByPlaceholder(instance),getByProps:getByProps(instance),getAllBy:getAllBy(instance),getAllByTestId:getAllByTestId(instance),getAllByName:getAllByName(instance),getAllByType:getAllByType(instance),getAllByText:getAllByText(instance),getAllByPlaceholder:getAllByPlaceholder(instance),getAllByProps:getAllByProps(instance)};};exports.getByAPI=getByAPI;